package EventScheduler;
import javax.swing.*;
import java.awt.*;
import java.awt.event.*;
import java.sql.*;
import java.util.*;
import java.util.Timer;

public class EventScheduler extends JFrame {
    private Connection conn;
    private int currentUserId = -1;

    private JTextField usernameField, nameField, dateField, timeField;
    private JPasswordField passwordField;
    private JTextArea descArea;
    private JButton loginBtn, signupBtn, addBtn, viewBtn;

    public EventScheduler() {
        connectToDatabase();
        showLoginPage();
    }

    // Step 1: Connect to Database
    private void connectToDatabase() {
        try {
            conn = DriverManager.getConnection(
                "jdbc:mysql://localhost:3306/event_scheduler", "root", "Saicharan@06");
            System.out.println("âœ… Connected to MySQL");
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Database connection failed:\n" + e.getMessage());
        }
    }

    // Step 2: Login Page
    private void showLoginPage() {
        getContentPane().removeAll();
        setTitle("Event Scheduler - Login");
        setSize(400, 300);
        setLayout(null);
        setDefaultCloseOperation(EXIT_ON_CLOSE);
        getContentPane().setBackground(new Color(230, 240, 250));

        JLabel title = new JLabel("User Login", SwingConstants.CENTER);
        title.setFont(new Font("Arial", Font.BOLD, 18));
        title.setBounds(100, 20, 200, 30);
        add(title);

        JLabel userLabel = new JLabel("Username:");
        userLabel.setBounds(50, 80, 100, 25);
        add(userLabel);

        usernameField = new JTextField();
        usernameField.setBounds(150, 80, 180, 25);
        add(usernameField);

        JLabel passLabel = new JLabel("Password:");
        passLabel.setBounds(50, 120, 100, 25);
        add(passLabel);

        passwordField = new JPasswordField();
        passwordField.setBounds(150, 120, 180, 25);
        add(passwordField);

        loginBtn = new JButton("Login");
        loginBtn.setBounds(80, 180, 100, 30);
        add(loginBtn);

        signupBtn = new JButton("Sign Up");
        signupBtn.setBounds(200, 180, 100, 30);
        add(signupBtn);

        loginBtn.addActionListener(e -> loginUser());
        signupBtn.addActionListener(e -> registerUser());

        revalidate();
        repaint();
        setVisible(true);
    }

    // Step 3: Register User
    private void registerUser() {
        try {
            String username = usernameField.getText();
            String password = String.valueOf(passwordField.getPassword());

            if (username.isEmpty() || password.isEmpty()) {
                JOptionPane.showMessageDialog(this, "Enter username and password!");
                return;
            }

            PreparedStatement ps = conn.prepareStatement(
                "INSERT INTO users (username, password) VALUES (?, ?)");
            ps.setString(1, username);
            ps.setString(2, password);
            ps.executeUpdate();

            JOptionPane.showMessageDialog(this, "âœ… Registration Successful! Please log in.");
        } catch (SQLIntegrityConstraintViolationException e) {
            JOptionPane.showMessageDialog(this, "âš ï¸ Username already exists!");
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Error: " + e.getMessage());
        }
    }

    // Step 4: Login User
    private void loginUser() {
        try {
            String username = usernameField.getText();
            String password = String.valueOf(passwordField.getPassword());

            PreparedStatement ps = conn.prepareStatement(
                "SELECT user_id FROM users WHERE username=? AND password=?");
            ps.setString(1, username);
            ps.setString(2, password);
            ResultSet rs = ps.executeQuery();

            if (rs.next()) {
                currentUserId = rs.getInt("user_id");
                JOptionPane.showMessageDialog(this, "âœ… Login Successful!");
                showMainApp();
            } else {
                JOptionPane.showMessageDialog(this, "âŒ Invalid Credentials!");
            }
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Login Error: " + e.getMessage());
        }
    }

    // Step 5: Main App Page (Add/View Events)
    private void showMainApp() {
        getContentPane().removeAll();
        setTitle("Event Scheduler with Notifications");
        setSize(550, 450);
        setLayout(null);
        getContentPane().setBackground(new Color(245, 250, 255));

        JLabel title = new JLabel("Event Scheduler", SwingConstants.CENTER);
        title.setFont(new Font("Arial", Font.BOLD, 18));
        title.setBounds(100, 20, 350, 30);
        add(title);

        JLabel nameLabel = new JLabel("Event Name:");
        nameLabel.setBounds(50, 80, 120, 25);
        add(nameLabel);

        nameField = new JTextField();
        nameField.setBounds(180, 80, 250, 25);
        add(nameField);

        JLabel dateLabel = new JLabel("Date (YYYY-MM-DD):");
        dateLabel.setBounds(50, 120, 150, 25);
        add(dateLabel);

        dateField = new JTextField();
        dateField.setBounds(200, 120, 150, 25);
        add(dateField);

        JLabel timeLabel = new JLabel("Time (HH:MM:SS):");
        timeLabel.setBounds(50, 160, 150, 25);
        add(timeLabel);

        timeField = new JTextField();
        timeField.setBounds(200, 160, 150, 25);
        add(timeField);

        JLabel descLabel = new JLabel("Description:");
        descLabel.setBounds(50, 200, 100, 25);
        add(descLabel);

        descArea = new JTextArea();
        descArea.setBounds(180, 200, 250, 60);
        add(descArea);

        addBtn = new JButton("Add Event");
        addBtn.setBounds(100, 300, 120, 35);
        add(addBtn);

        viewBtn = new JButton("View My Events");
        viewBtn.setBounds(260, 300, 150, 35);
        add(viewBtn);

        JButton logoutBtn = new JButton("Logout");
        logoutBtn.setBounds(420, 20, 90, 25);
        add(logoutBtn);

        addBtn.addActionListener(e -> addEvent());
        viewBtn.addActionListener(e -> viewEvents());
        logoutBtn.addActionListener(e -> {
            currentUserId = -1;
            showLoginPage();
        });

        revalidate();
        repaint();
    }

    // Step 6: Add Event for Logged-in User
    private void addEvent() {
        try {
            String name = nameField.getText();
            String date = dateField.getText();
            String time = timeField.getText();
            String desc = descArea.getText();

            if (name.isEmpty() || date.isEmpty() || time.isEmpty()) {
                JOptionPane.showMessageDialog(this, "âš ï¸ Fill all fields!");
                return;
            }

            PreparedStatement ps = conn.prepareStatement(
                "INSERT INTO events (user_id, event_name, event_date, event_time, description) VALUES (?, ?, ?, ?, ?)");
            ps.setInt(1, currentUserId);
            ps.setString(2, name);
            ps.setString(3, date);
            ps.setString(4, time);
            ps.setString(5, desc);
            ps.executeUpdate();

            JOptionPane.showMessageDialog(this, "âœ… Event Added!");
            scheduleNotification(name, time);
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Error adding event: " + e.getMessage());
        }
    }

    // Step 7: View Only My Events
    private void viewEvents() {
        try {
            PreparedStatement ps = conn.prepareStatement(
                "SELECT event_name, event_date, event_time, description FROM events WHERE user_id=? ORDER BY event_date, event_time");
            ps.setInt(1, currentUserId);
            ResultSet rs = ps.executeQuery();

            StringBuilder sb = new StringBuilder("ðŸ“… Your Events:\n\n");
            while (rs.next()) {
                sb.append("â–¶ ").append(rs.getString("event_name"))
                  .append(" | Date: ").append(rs.getString("event_date"))
                  .append(" | Time: ").append(rs.getString("event_time"))
                  .append("\nDesc: ").append(rs.getString("description")).append("\n\n");
            }

            JOptionPane.showMessageDialog(this, sb.toString());
        } catch (Exception e) {
            JOptionPane.showMessageDialog(this, "Error fetching events: " + e.getMessage());
        }
    }

 // Step 8: Notification (Demo + Database Update)
    private void scheduleNotification(String eventName, String eventTime) {
        Timer timer = new Timer();
        timer.schedule(new TimerTask() {
            public void run() {
                JOptionPane.showMessageDialog(null,
                    "ðŸ”” Reminder: " + eventName + " at " + eventTime);

                // After showing notification, mark as Sent in DB
                try {
                    PreparedStatement ps = conn.prepareStatement(
                        "UPDATE events SET notification_status = 'Sent' WHERE user_id = ? AND event_name = ?");
                    ps.setInt(1, currentUserId);
                    ps.setString(2, eventName);
                    ps.executeUpdate();
                    System.out.println("âœ… Notification status updated for: " + eventName);
                } catch (Exception e) {
                    System.err.println("âš ï¸ Failed to update notification status: " + e.getMessage());
                }
            }
        }, 5000); // Demo 5-second delay
    }


    // Step 9: Main Method
    public static void main(String[] args) {
        SwingUtilities.invokeLater(() -> new EventScheduler());
    }
}




 

 




 

 

 



